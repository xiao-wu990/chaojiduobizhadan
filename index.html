<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>炸弹躲避大冒险</title>
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #ff6b6b;
            --accent-color: #feca57;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --success-color: #1dd1a1;
            --danger-color: #ff4757;
            --warning-color: #ff9f43;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }

        body {
            background-color: #f5f6fa;
            color: var(--dark-color);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* 登录界面样式 */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), #6c5ce7);
            padding: 20px;
        }

        .auth-box {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--dark-color);
            font-size: 24px;
        }

        .auth-form .form-group {
            margin-bottom: 20px;
        }

        .auth-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .auth-form input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .auth-form input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-check input {
            width: auto;
            margin-right: 10px;
        }

        .form-check label {
            margin-bottom: 0;
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .auth-btn:hover {
            background-color: #3a56e0;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .auth-switch a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        /* 主界面样式 */
        .main-container {
            display: none;
            min-height: 100vh;
            background-color: #f5f6fa;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #6c5ce7);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .logo {
            font-size: 22px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
            font-size: 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-color);
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--dark-color);
            cursor: pointer;
            background-size: cover;
            background-position: center;
        }

        .user-name {
            font-weight: bold;
            margin-right: 15px;
            cursor: pointer;
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        /* 侧边栏样式 */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background-color: white;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 100;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), #6c5ce7);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .menu-item:hover {
            background-color: #f8f9fa;
        }

        .menu-item i {
            margin-right: 15px;
            font-size: 18px;
            color: var(--dark-color);
        }

        .menu-item.active {
            background-color: #e9f0ff;
            border-left: 4px solid var(--primary-color);
        }

        .sidebar-footer {
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .sidebar-footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .sidebar-footer a:hover {
            text-decoration: underline;
        }

        /* 游戏主页样式 */
        .home-content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .welcome-section {
            background: linear-gradient(135deg, var(--primary-color), #6c5ce7);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .welcome-title {
            font-size: 28px;
            margin-bottom: 15px;
        }

        .welcome-text {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .start-btn {
            background-color: white;
            color: var(--primary-color);
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .stats-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            width: calc(33.333% - 20px);
            margin-bottom: 20px;
            text-align: center;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .leaderboard-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
        }

        .leaderboard-list {
            list-style: none;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            background-color: #f8f9fa;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .leaderboard-rank.top3 {
            background-color: var(--accent-color);
            color: white;
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f8f9fa;
            margin-right: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--dark-color);
            background-size: cover;
            background-position: center;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .leaderboard-score {
            color: #666;
            font-size: 14px;
        }

        .leaderboard-score span {
            color: var(--primary-color);
            font-weight: bold;
        }

        /* 游戏界面样式 */
        .game-container {
            display: none;
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 600px;
            margin: 20px auto;
            background-color: #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            color: white;
            font-weight: bold;
        }

        .game-score {
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .game-score i {
            margin-right: 8px;
            color: var(--accent-color);
        }

        .game-lives {
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .game-lives i {
            margin-right: 8px;
            color: var(--danger-color);
        }

        .game-keys {
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .game-keys i {
            margin-right: 8px;
            color: var(--success-color);
        }

        .player {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            z-index: 5;
            transition: transform 0.1s;
            background-size: cover;
            background-position: center;
        }

        .bomb {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ff4757;
            z-index: 4;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }

        .powerup {
            position: absolute;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            z-index: 4;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            animation: float 2s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .powerup.speed-up {
            background-color: var(--success-color);
        }

        .powerup.speed-down {
            background-color: var(--warning-color);
        }

        .powerup.life {
            background-color: var(--danger-color);
        }

        .powerup.key {
            background-color: var(--accent-color);
        }

        .powerup.coin {
            background-color: gold;
        }

        /* 游戏结束界面 */
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            color: white;
        }

        .game-over-title {
            font-size: 36px;
            margin-bottom: 20px;
            color: var(--danger-color);
        }

        .final-score {
            font-size: 24px;
            margin-bottom: 30px;
        }

        .final-score span {
            color: var(--accent-color);
            font-weight: bold;
        }

        .game-over-btns {
            display: flex;
            gap: 15px;
        }

        .game-over-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .game-over-btn:hover {
            transform: translateY(-3px);
        }

        .restart-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .home-btn {
            background-color: white;
            color: var(--dark-color);
        }

        /* 高分恭喜界面 */
        .high-score {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            color: white;
        }

        .high-score-title {
            font-size: 36px;
            margin-bottom: 20px;
            color: var(--accent-color);
            text-align: center;
        }

        .high-score-text {
            font-size: 24px;
            margin-bottom: 30px;
            text-align: center;
        }

        .high-score-text span {
            color: var(--accent-color);
            font-weight: bold;
        }

        .high-score-btns {
            display: flex;
            gap: 15px;
        }

        /* 商店界面 */
        .shop-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .shop-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .shop-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            transition: color 0.2s;
        }

        .shop-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            margin-bottom: -2px;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .shop-item {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            text-align: center;
        }

        .shop-item:hover {
            transform: translateY(-5px);
        }

        .item-image {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            border-radius: 10px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            background-size: cover;
            background-position: center;
        }

        .item-name {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .item-price {
            color: var(--accent-color);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .item-btn {
            width: 100%;
            padding: 8px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .item-btn:hover {
            background-color: #3a56e0;
        }

        .item-btn.owned {
            background-color: var(--success-color);
        }

        .item-btn.equipped {
            background-color: var(--accent-color);
        }

        /* 个人资料界面 */
        .profile-container {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f8f9fa;
            margin-right: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            font-weight: bold;
            color: var(--dark-color);
            cursor: pointer;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }

        .profile-avatar-edit {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            text-align: center;
            padding: 5px;
            font-size: 14px;
            transform: translateY(100%);
            transition: transform 0.2s;
        }

        .profile-avatar:hover .profile-avatar-edit {
            transform: translateY(0);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .profile-badge {
            background-color: var(--accent-color);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }

        .profile-stats {
            display: flex;
            margin-top: 15px;
        }

        .profile-stat {
            margin-right: 20px;
            text-align: center;
        }

        .profile-stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .profile-stat-label {
            font-size: 12px;
            color: #666;
        }

        .profile-body {
            margin-top: 30px;
        }

        .profile-form .form-group {
            margin-bottom: 20px;
        }

        .profile-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .profile-form input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .profile-form input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .profile-save-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .profile-save-btn:hover {
            background-color: #3a56e0;
        }

        /* 对战界面 */
        .battle-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .battle-search {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            text-align: center;
        }

        .battle-search-title {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .battle-search-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .battle-search-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .battle-rooms {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .battle-room {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .battle-room:hover {
            background-color: #f8f9fa;
        }

        .battle-room-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #f8f9fa;
            margin-right: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--dark-color);
            background-size: cover;
            background-position: center;
        }

        .battle-room-info {
            flex: 1;
        }

        .battle-room-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .battle-room-status {
            color: #666;
            font-size: 14px;
        }

        .battle-room-join {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .battle-room-join:hover {
            background-color: #3a56e0;
        }

        /* 管理员界面 */
        .admin-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            transition: color 0.2s;
        }

        .admin-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            margin-bottom: -2px;
        }

        .admin-content {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .admin-users {
            margin-top: 20px;
        }

        .admin-user {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .admin-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #f8f9fa;
            margin-right: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--dark-color);
            background-size: cover;
            background-position: center;
        }

        .admin-user-info {
            flex: 1;
        }

        .admin-user-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .admin-user-id {
            color: #666;
            font-size: 14px;
        }

        .admin-user-actions {
            display: flex;
            gap: 10px;
        }

        .admin-user-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .admin-user-btn.ban {
            background-color: var(--danger-color);
            color: white;
        }

        .admin-user-btn.promote {
            background-color: var(--success-color);
            color: white;
        }

        .admin-user-btn.gift {
            background-color: var(--accent-color);
            color: white;
        }

        /* 开发者界面 */
        .dev-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .dev-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dev-stat {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .dev-stat-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .dev-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .dev-actions {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .dev-action-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .dev-action-btns {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .dev-action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dev-action-btn.revoke {
            background-color: var(--danger-color);
            color: white;
        }

        .dev-action-btn.update {
            background-color: var(--primary-color);
            color: white;
        }

        .dev-code-editor {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .dev-code-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .dev-code-textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 15px;
            resize: vertical;
        }

        .dev-code-submit {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dev-code-submit:hover {
            background-color: #3a56e0;
        }

        /* 移动端控制按钮 */
        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 0 20px;
            z-index: 50;
        }

        .mobile-controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            max-width: 300px;
            margin: 0 auto;
        }

        .mobile-btn {
            width: 100%;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .mobile-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .mobile-btn.up {
            grid-column: 2;
            grid-row: 1;
        }

        .mobile-btn.left {
            grid-column: 1;
            grid-row: 2;
        }

        .mobile-btn.right {
            grid-column: 3;
            grid-row: 2;
        }

        .mobile-btn.down {
            grid-column: 2;
            grid-row: 2;
        }

        .mobile-btn.action {
            grid-column: 1 / span 3;
            grid-row: 3;
            height: 50px;
            font-size: 18px;
            background-color: rgba(74, 107, 255, 0.7);
        }

        .mobile-btn.action:hover {
            background-color: rgba(74, 107, 255, 0.9);
        }

        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.3s ease;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .modal-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--dark-color);
        }

        .modal-text {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal-btns {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .modal-btn.cancel {
            background-color: #f8f9fa;
            color: #666;
        }

        .modal-btn.confirm {
            background-color: var(--primary-color);
            color: white;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .stats-section {
                flex-direction: column;
            }
            
            .stat-card {
                width: 100%;
            }
            
            .mobile-controls {
                display: block;
            }
            
            .sidebar {
                width: 80%;
                left: -80%;
            }
            
            .game-container {
                height: 500px;
            }
            
            .shop-items {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-avatar {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .profile-stats {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .auth-box {
                padding: 20px;
            }
            
            .welcome-title {
                font-size: 24px;
            }
            
            .section-title {
                font-size: 18px;
            }
            
            .leaderboard-item {
                flex-direction: column;
                text-align: center;
            }
            
            .leaderboard-avatar {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .game-over-btns, .high-score-btns {
                flex-direction: column;
                width: 100%;
            }
            
            .game-over-btn {
                width: 100%;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .modal-btns {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
        }

        /* 动画效果 */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s;
        }

        /* 工具类 */
        .text-center {
            text-align: center;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .d-none {
            display: none !important;
        }

        /* 图标字体 */
        .fas, .far, .fab {
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
        }

        .fab {
            font-family: 'Font Awesome 5 Brands';
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <!-- 登录界面 -->
    <div class="auth-container" id="auth-container">
        <div class="auth-box">
            <div class="auth-title" id="auth-title">欢迎登录</div>
            <form class="auth-form" id="auth-form">
                <div class="form-group">
                    <label for="auth-username">用户名</label>
                    <input type="text" id="auth-username" placeholder="请输入用户名" required>
                </div>
                <div class="form-group">
                    <label for="auth-password">密码</label>
                    <input type="password" id="auth-password" placeholder="请输入密码" required>
                </div>
                <div class="form-check">
                    <input type="checkbox" id="remember-me">
                    <label for="remember-me">30天内自动登录</label>
                </div>
                <button type="submit" class="auth-btn" id="auth-submit">登录</button>
            </form>
            <div class="auth-switch" id="auth-switch">
                还没有账号？<a id="switch-to-register">立即注册</a>
            </div>
        </div>
    </div>

    <!-- 主界面 -->
    <div class="main-container" id="main-container">
        <!-- 顶部导航 -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-bomb"></i>
                <span>炸弹躲避大冒险</span>
            </div>
            <div class="user-info">
                <span class="user-name" id="header-username">游客</span>
                <div class="user-avatar" id="header-avatar">G</div>
                <button class="menu-btn" id="menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>

        <!-- 侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">菜单</div>
                <button class="close-sidebar" id="close-sidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-target="home">
                    <i class="fas fa-home"></i>
                    <span>首页</span>
                </div>
                <div class="menu-item" data-target="game">
                    <i class="fas fa-gamepad"></i>
                    <span>开始游戏</span>
                </div>
                <div class="menu-item" data-target="battle">
                    <i class="fas fa-trophy"></i>
                    <span>对战模式</span>
                </div>
                <div class="menu-item" data-target="shop">
                    <i class="fas fa-shopping-cart"></i>
                    <span>商店</span>
                </div>
                <div class="menu-item" data-target="profile">
                    <i class="fas fa-user"></i>
                    <span>个人资料</span>
                </div>
                <div class="menu-item d-none" id="admin-menu-item" data-target="admin">
                    <i class="fas fa-shield-alt"></i>
                    <span>管理员</span>
                </div>
                <div class="menu-item d-none" id="dev-menu-item" data-target="dev">
                    <i class="fas fa-code"></i>
                    <span>开发者</span>
                </div>
            </div>
            <div class="sidebar-footer">
                <a href="https://qm.qq.com/q/kTAmEkJ8Na" target="_blank"><i class="fab fa-qq"></i> 加入QQ群</a> | 
                <a href="mailto:3530388417@qq.com"><i class="fas fa-envelope"></i> 联系开发者</a>
            </div>
        </div>

        <!-- 主页内容 -->
        <div class="home-content" id="home-content">
            <div class="welcome-section">
                <h1 class="welcome-title">炸弹躲避大冒险</h1>
                <p class="welcome-text">躲避从天而降的炸弹，收集金币和道具，挑战最高分！</p>
                <button class="start-btn" id="start-game-btn">
                    <i class="fas fa-play"></i> 开始游戏
                </button>
            </div>

            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-value" id="high-score">0</div>
                    <div class="stat-label">最高分</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-value" id="coin-count">0</div>
                    <div class="stat-label">金币</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-value" id="key-count">0</div>
                    <div class="stat-label">钥匙</div>
                </div>
            </div>

            <div class="leaderboard-section">
                <h2 class="section-title">
                    <i class="fas fa-crown"></i>
                    <span>排行榜</span>
                </h2>
                <ul class="leaderboard-list" id="leaderboard-list">
                    <li class="leaderboard-item">
                        <div class="leaderboard-rank top3">1</div>
                        <div class="leaderboard-avatar" style="background-color: #feca57;">A</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">Alice</div>
                            <div class="leaderboard-score">分数: <span>1250</span></div>
                        </div>
                    </li>
                    <li class="leaderboard-item">
                        <div class="leaderboard-rank top3">2</div>
                        <div class="leaderboard-avatar" style="background-color: #a4b0be;">B</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">Bob</div>
                            <div class="leaderboard-score">分数: <span>980</span></div>
                        </div>
                    </li>
                    <li class="leaderboard-item">
                        <div class="leaderboard-rank top3">3</div>
                        <div class="leaderboard-avatar" style="background-color: #1dd1a1;">C</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">Charlie</div>
                            <div class="leaderboard-score">分数: <span>750</span></div>
                        </div>
                    </li>
                    <!-- 更多排行榜项将通过JavaScript动态添加 -->
                </ul>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div class="game-container" id="game-container">
            <div class="game-ui">
                <div class="game-score">
                    <i class="fas fa-star"></i>
                    <span id="game-score">0</span>
                </div>
                <div class="game-lives">
                    <i class="fas fa-heart"></i>
                    <span id="game-lives">3</span>
                </div>
                <div class="game-keys">
                    <i class="fas fa-key"></i>
                    <span id="game-keys">0</span>
                </div>
            </div>
            <div class="player" id="player"></div>
            <!-- 炸弹和道具将通过JavaScript动态添加 -->
            
            <!-- 游戏结束界面 -->
            <div class="game-over" id="game-over">
                <h2 class="game-over-title">游戏结束</h2>
                <div class="final-score">你的分数: <span id="final-score">0</span></div>
                <div class="game-over-btns">
                    <button class="game-over-btn restart-btn" id="restart-btn">
                        <i class="fas fa-redo"></i> 再来一局
                    </button>
                    <button class="game-over-btn home-btn" id="game-home-btn">
                        <i class="fas fa-home"></i> 返回主页
                    </button>
                </div>
            </div>
            
            <!-- 高分恭喜界面 -->
            <div class="high-score" id="high-score-screen">
                <h2 class="high-score-title">恭喜你创造了新纪录！</h2>
                <div class="high-score-text">你的新纪录: <span id="new-high-score">0</span></div>
                <div class="game-over-btns">
                    <button class="game-over-btn restart-btn" id="high-score-restart-btn">
                        <i class="fas fa-redo"></i> 再来一局
                    </button>
                    <button class="game-over-btn home-btn" id="high-score-home-btn">
                        <i class="fas fa-home"></i> 返回主页
                    </button>
                </div>
            </div>
        </div>

        <!-- 商店界面 -->
        <div class="shop-container" id="shop-content">
            <div class="shop-tabs">
                <div class="shop-tab active" data-tab="skins">皮肤</div>
                <div class="shop-tab" data-tab="avatars">头像</div>
                <div class="shop-tab" data-tab="vip">VIP</div>
            </div>
            
            <div class="shop-items" id="skins-tab">
                <!-- 皮肤商品将通过JavaScript动态添加 -->
                <div class="shop-item">
                    <div class="item-image" style="background-color: #4a6bff;">
                        <i class="fas fa-user" style="color: white;"></i>
                    </div>
                    <div class="item-name">默认皮肤</div>
                    <div class="item-price">免费</div>
                    <button class="item-btn equipped">已装备</button>
                </div>
            </div>
            
            <div class="shop-items d-none" id="avatars-tab">
                <!-- 头像商品将通过JavaScript动态添加 -->
                <div class="shop-item">
                    <div class="item-image" style="background-color: #f8f9fa;">
                        <i class="fas fa-user" style="color: #666;"></i>
                    </div>
                    <div class="item-name">默认头像</div>
                    <div class="item-price">免费</div>
                    <button class="item-btn equipped">已装备</button>
                </div>
            </div>
            
            <div class="shop-items d-none" id="vip-tab">
                <!-- VIP商品将通过JavaScript动态添加 -->
                <div class="shop-item">
                    <div class="item-image" style="background: linear-gradient(135deg, #feca57, #ff9f43);">
                        <i class="fas fa-crown" style="color: white;"></i>
                    </div>
                    <div class="item-name">VIP月卡</div>
                    <div class="item-price">200金币</div>
                    <button class="item-btn">购买</button>
                </div>
                <div class="shop-item">
                    <div class="item-image" style="background: linear-gradient(135deg, #4a6bff, #6c5ce7);">
                        <i class="fas fa-crown" style="color: white;"></i>
                    </div>
                    <div class="item-name">VIP年卡</div>
                    <div class="item-price">1000金币</div>
                    <button class="item-btn">购买</button>
                </div>
            </div>
        </div>

        <!-- 个人资料界面 -->
        <div class="profile-container" id="profile-content">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar" id="profile-avatar">
                        <div class="profile-avatar-edit">点击修改</div>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name">
                            <span id="profile-display-name">游客</span>
                            <span class="profile-badge d-none" id="vip-badge">VIP</span>
                            <span class="profile-badge d-none" id="admin-badge">管理员</span>
                        </div>
                        <div class="profile-stats">
                            <div class="profile-stat">
                                <div class="profile-stat-value" id="profile-high-score">0</div>
                                <div class="profile-stat-label">最高分</div>
                            </div>
                            <div class="profile-stat">
                                <div class="profile-stat-value" id="profile-coins">0</div>
                                <div class="profile-stat-label">金币</div>
                            </div>
                            <div class="profile-stat">
                                <div class="profile-stat-value" id="profile-keys">0</div>
                                <div class="profile-stat-label">钥匙</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-body">
                    <form class="profile-form" id="profile-form">
                        <div class="form-group">
                            <label for="profile-username">用户名</label>
                            <input type="text" id="profile-username" readonly>
                        </div>
                        <div class="form-group">
                            <label for="profile-nickname">昵称</label>
                            <input type="text" id="profile-nickname" placeholder="请输入昵称">
                        </div>
                        <div class="form-group">
                            <label for="profile-password">修改密码</label>
                            <input type="password" id="profile-password" placeholder="留空则不修改">
                        </div>
                        <div class="form-group">
                            <label for="profile-confirm-password">确认密码</label>
                            <input type="password" id="profile-confirm-password" placeholder="再次输入新密码">
                        </div>
                        <button type="submit" class="profile-save-btn">保存更改</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- 对战界面 -->
        <div class="battle-container" id="battle-content">
            <div class="battle-search">
                <h3 class="battle-search-title">在线对战</h3>
                <button class="battle-search-btn" id="find-opponent-btn">
                    <i class="fas fa-search"></i> 寻找对手
                </button>
            </div>
            
            <div class="leaderboard-section">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    <span>在线玩家</span>
                </h2>
                <div class="battle-rooms" id="battle-rooms">
                    <!-- 对战房间将通过JavaScript动态添加 -->
                    <div class="battle-room">
                        <div class="battle-room-avatar" style="background-color: #4a6bff;">A</div>
                        <div class="battle-room-info">
                            <div class="battle-room-name">Alice</div>
                            <div class="battle-room-status">最高分: 1250</div>
                        </div>
                        <button class="battle-room-join">挑战</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 管理员界面 -->
        <div class="admin-container" id="admin-content">
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="users">用户管理</div>
                <div class="admin-tab" data-tab="reports">举报处理</div>
            </div>
            
            <div class="admin-content">
                <div id="users-tab">
                    <h3 class="section-title">
                        <i class="fas fa-user-cog"></i>
                        <span>用户列表</span>
                    </h3>
                    <div class="admin-users" id="admin-users-list">
                        <!-- 用户列表将通过JavaScript动态添加 -->
                        <div class="admin-user">
                            <div class="admin-user-avatar">A</div>
                            <div class="admin-user-info">
                                <div class="admin-user-name">Alice</div>
                                <div class="admin-user-id">ID: user123</div>
                            </div>
                            <div class="admin-user-actions">
                                <button class="admin-user-btn promote">设为管理员</button>
                                <button class="admin-user-btn ban">封禁</button>
                                <button class="admin-user-btn gift">赠送金币</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="d-none" id="reports-tab">
                    <h3 class="section-title">
                        <i class="fas fa-flag"></i>
                        <span>举报列表</span>
                    </h3>
                    <p>暂无举报</p>
                </div>
            </div>
        </div>

        <!-- 开发者界面 -->
        <div class="dev-container" id="dev-content">
            <div class="dev-stats">
                <div class="dev-stat">
                    <div class="dev-stat-title">注册用户</div>
                    <div class="dev-stat-value" id="total-users">0</div>
                </div>
                <div class="dev-stat">
                    <div class="dev-stat-title">今日活跃</div>
                    <div class="dev-stat-value" id="active-users">0</div>
                </div>
                <div class="dev-stat">
                    <div class="dev-stat-title">总游戏次数</div>
                    <div class="dev-stat-value" id="total-games">0</div>
                </div>
                <div class="dev-stat">
                    <div class="dev-stat-title">最高分</div>
                    <div class="dev-stat-value" id="global-high-score">0</div>
                </div>
            </div>
            
            <div class="dev-actions">
                <h3 class="dev-action-title">管理操作</h3>
                <div class="dev-action-btns">
                    <button class="dev-action-btn revoke" id="revoke-account-btn">
                        <i class="fas fa-user-slash"></i> 收回账户
                    </button>
                    <button class="dev-action-btn update" id="update-site-btn">
                        <i class="fas fa-sync-alt"></i> 更新网站
                    </button>
                </div>
            </div>
            
            <div class="dev-code-editor">
                <h3 class="dev-code-title">网站代码</h3>
                <textarea class="dev-code-textarea" id="code-editor" placeholder="在此处粘贴更新代码..."></textarea>
                <button class="dev-code-submit" id="update-code-btn">提交更新</button>
            </div>
        </div>

        <!-- 移动端控制按钮 -->
        <div class="mobile-controls" id="mobile-controls">
            <div class="mobile-controls-grid">
                <button class="mobile-btn up" id="mobile-up">
                    <i class="fas fa-arrow-up"></i>
                </button>
                <button class="mobile-btn left" id="mobile-left">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="mobile-btn right" id="mobile-right">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="mobile-btn down" id="mobile-down">
                    <i class="fas fa-arrow-down"></i>
                </button>
                <button class="mobile-btn action" id="mobile-action">
                    <i class="fas fa-key"></i> 使用钥匙
                </button>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div class="modal" id="key-modal">
        <div class="modal-content">
            <button class="modal-close" id="close-key-modal">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="modal-title">使用钥匙</h3>
            <p class="modal-text">你被炸弹击中了！是否使用钥匙来继续游戏？</p>
            <div class="modal-btns">
                <button class="modal-btn cancel" id="cancel-key">取消</button>
                <button class="modal-btn confirm" id="confirm-key">使用钥匙</button>
            </div>
        </div>
    </div>

    <div class="modal" id="message-modal">
        <div class="modal-content">
            <button class="modal-close" id="close-message-modal">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="modal-title" id="message-title">提示</h3>
            <p class="modal-text" id="message-text">这是一条消息</p>
            <div class="modal-btns">
                <button class="modal-btn confirm" id="confirm-message">确定</button>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据
        const gameData = {
            // 用户数据
            currentUser: null,
            users: [
                {
                    id: 'user1',
                    username: 'test',
                    password: 'test123',
                    nickname: '测试用户',
                    highScore: 250,
                    coins: 100,
                    keys: 2,
                    avatar: '',
                    skins: ['default'],
                    equippedSkin: 'default',
                    avatars: ['default'],
                    equippedAvatar: 'default',
                    isAdmin: false,
                    isDev: false,
                    isVIP: false,
                    vipExpiry: null,
                    lastLogin: new Date().getTime()
                },
                // 开发者账户 (隐藏)
                {
                    id: 'dev1',
                    username: '3530388417',
                    password: '19996837879gxh',
                    nickname: '开发者',
                    highScore: 9999,
                    coins: 999999,
                    keys: 999,
                    avatar: '',
                    skins: ['default', 'premium', 'vip'],
                    equippedSkin: 'default',
                    avatars: ['default', 'premium'],
                    equippedAvatar: 'default',
                    isAdmin: true,
                    isDev: true,
                    isVIP: true,
                    vipExpiry: new Date().getTime() + 365 * 24 * 60 * 60 * 1000,
                    lastLogin: new Date().getTime()
                }
            ],
            
            // 商店数据
            shopItems: {
                skins: [
                    { id: 'default', name: '默认皮肤', price: 0, icon: 'fas fa-user', color: '#4a6bff' },
                    { id: 'red', name: '红色皮肤', price: 50, icon: 'fas fa-user', color: '#ff4757' },
                    { id: 'green', name: '绿色皮肤', price: 50, icon: 'fas fa-user', color: '#1dd1a1' },
                    { id: 'yellow', name: '黄色皮肤', price: 50, icon: 'fas fa-user', color: '#feca57' },
                    { id: 'premium', name: '高级皮肤', price: 200, icon: 'fas fa-user-astronaut', color: '#6c5ce7' },
                    { id: 'vip', name: 'VIP皮肤', price: 500, icon: 'fas fa-crown', color: '#ff9f43' }
                ],
                avatars: [
                    { id: 'default', name: '默认头像', price: 0, icon: 'fas fa-user', color: '#f8f9fa' },
                    { id: 'red', name: '红色头像', price: 30, icon: 'fas fa-user', color: '#ff4757' },
                    { id: 'green', name: '绿色头像', price: 30, icon: 'fas fa-user', color: '#1dd1a1' },
                    { id: 'yellow', name: '黄色头像', price: 30, icon: 'fas fa-user', color: '#feca57' },
                    { id: 'premium', name: '高级头像', price: 150, icon: 'fas fa-user-astronaut', color: '#6c5ce7' },
                    { id: 'custom', name: '自定义头像', price: 300, icon: 'fas fa-camera', color: '#4a6bff' }
                ],
                vip: [
                    { id: 'vip-month', name: 'VIP月卡', price: 200, duration: 30 },
                    { id: 'vip-year', name: 'VIP年卡', price: 1000, duration: 365 }
                ]
            },
            
            // 排行榜数据
            leaderboard: [
                { id: 'user1', name: '测试用户', score: 250, avatar: '' },
                { id: 'user2', name: 'Alice', score: 1250, avatar: '' },
                { id: 'user3', name: 'Bob', score: 980, avatar: '' },
                { id: 'user4', name: 'Charlie', score: 750, avatar: '' },
                { id: 'user5', name: 'David', score: 600, avatar: '' }
            ],
            
            // 在线用户数据
            onlineUsers: [
                { id: 'user1', name: '测试用户', score: 250, avatar: '', status: 'online' },
                { id: 'user2', name: 'Alice', score: 1250, avatar: '', status: 'online' },
                { id: 'user3', name: 'Bob', score: 980, avatar: '', status: 'in-game' },
                { id: 'user4', name: 'Charlie', score: 750, avatar: '', status: 'online' }
            ],
            
            // 游戏状态
            gameState: {
                isPlaying: false,
                score: 0,
                lives: 3,
                keys: 0,
                speed: 2,
                level: 1,
                playerX: 0,
                playerY: 0,
                playerWidth: 40,
                playerHeight: 40,
                bombs: [],
                powerups: [],
                lastBombTime: 0,
                lastPowerupTime: 0,
                animationId: null,
                startTime: 0,
                keysPressed: {}
            }
        };

        // DOM元素
        const elements = {
            // 认证界面
            authContainer: document.getElementById('auth-container'),
            authTitle: document.getElementById('auth-title'),
            authForm: document.getElementById('auth-form'),
            authUsername: document.getElementById('auth-username'),
            authPassword: document.getElementById('auth-password'),
            authSubmit: document.getElementById('auth-submit'),
            authSwitch: document.getElementById('auth-switch'),
            switchToRegister: document.getElementById('switch-to-register'),
            rememberMe: document.getElementById('remember-me'),
            
            // 主界面
            mainContainer: document.getElementById('main-container'),
            headerUsername: document.getElementById('header-username'),
            headerAvatar: document.getElementById('header-avatar'),
            menuBtn: document.getElementById('menu-btn'),
            sidebar: document.getElementById('sidebar'),
            closeSidebar: document.getElementById('close-sidebar'),
            menuItems: document.querySelectorAll('.menu-item'),
            adminMenuItem: document.getElementById('admin-menu-item'),
            devMenuItem: document.getElementById('dev-menu-item'),
            
            // 主页内容
            homeContent: document.getElementById('home-content'),
            highScoreDisplay: document.getElementById('high-score'),
            coinCount: document.getElementById('coin-count'),
            keyCount: document.getElementById('key-count'),
            startGameBtn: document.getElementById('start-game-btn'),
            leaderboardList: document.getElementById('leaderboard-list'),
            
            // 游戏界面
            gameContainer: document.getElementById('game-container'),
            gameScore: document.getElementById('game-score'),
            gameLives: document.getElementById('game-lives'),
            gameKeys: document.getElementById('game-keys'),
            player: document.getElementById('player'),
            gameOverScreen: document.getElementById('game-over'),
            finalScore: document.getElementById('final-score'),
            restartBtn: document.getElementById('restart-btn'),
            gameHomeBtn: document.getElementById('game-home-btn'),
            highScoreScreen: document.getElementById('high-score-screen'),
            newHighScore: document.getElementById('new-high-score'),
            highScoreRestartBtn: document.getElementById('high-score-restart-btn'),
            highScoreHomeBtn: document.getElementById('high-score-home-btn'),
            
            // 商店界面
            shopContent: document.getElementById('shop-content'),
            shopTabs: document.querySelectorAll('.shop-tab'),
            skinsTab: document.getElementById('skins-tab'),
            avatarsTab: document.getElementById('avatars-tab'),
            vipTab: document.getElementById('vip-tab'),
            
            // 个人资料界面
            profileContent: document.getElementById('profile-content'),
            profileAvatar: document.getElementById('profile-avatar'),
            profileDisplayName: document.getElementById('profile-display-name'),
            vipBadge: document.getElementById('vip-badge'),
            adminBadge: document.getElementById('admin-badge'),
            profileUsername: document.getElementById('profile-username'),
            profileNickname: document.getElementById('profile-nickname'),
            profilePassword: document.getElementById('profile-password'),
            profileConfirmPassword: document.getElementById('profile-confirm-password'),
            profileForm: document.getElementById('profile-form'),
            profileHighScore: document.getElementById('profile-high-score'),
            profileCoins: document.getElementById('profile-coins'),
            profileKeys: document.getElementById('profile-keys'),
            
            // 对战界面
            battleContent: document.getElementById('battle-content'),
            findOpponentBtn: document.getElementById('find-opponent-btn'),
            battleRooms: document.getElementById('battle-rooms'),
            
            // 管理员界面
            adminContent: document.getElementById('admin-content'),
            adminTabs: document.querySelectorAll('.admin-tab'),
            adminUsersList: document.getElementById('admin-users-list'),
            
            // 开发者界面
            devContent: document.getElementById('dev-content'),
            totalUsers: document.getElementById('total-users'),
            activeUsers: document.getElementById('active-users'),
            totalGames: document.getElementById('total-games'),
            globalHighScore: document.getElementById('global-high-score'),
            revokeAccountBtn: document.getElementById('revoke-account-btn'),
            updateSiteBtn: document.getElementById('update-site-btn'),
            codeEditor: document.getElementById('code-editor'),
            updateCodeBtn: document.getElementById('update-code-btn'),
            
            // 移动控制
            mobileControls: document.getElementById('mobile-controls'),
            mobileUp: document.getElementById('mobile-up'),
            mobileLeft: document.getElementById('mobile-left'),
            mobileRight: document.getElementById('mobile-right'),
            mobileDown: document.getElementById('mobile-down'),
            mobileAction: document.getElementById('mobile-action'),
            
            // 模态框
            keyModal: document.getElementById('key-modal'),
            closeKeyModal: document.getElementById('close-key-modal'),
            cancelKey: document.getElementById('cancel-key'),
            confirmKey: document.getElementById('confirm-key'),
            messageModal: document.getElementById('message-modal'),
            closeMessageModal: document.getElementById('close-message-modal'),
            messageTitle: document.getElementById('message-title'),
            messageText: document.getElementById('message-text'),
            confirmMessage: document.getElementById('confirm-message')
        };

        // 初始化函数
        function init() {
            // 检查本地存储中是否有记住的用户
            checkRememberedUser();
            
            // 设置事件监听器
            setupEventListeners();
            
            // 更新UI
            updateUI();
        }

        // 检查记住的用户
        function checkRememberedUser() {
            const rememberedUser = localStorage.getItem('rememberedUser');
            if (rememberedUser) {
                const userData = JSON.parse(rememberedUser);
                const user = gameData.users.find(u => u.username === userData.username && u.password === userData.password);
                
                if (user) {
                    loginUser(user);
                }
            }
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 认证表单提交
            elements.authForm.addEventListener('submit', function(e) {
                e.preventDefault();
                handleAuthSubmit();
            });
            
            // 切换注册/登录
            elements.switchToRegister.addEventListener('click', function(e) {
                e.preventDefault();
                toggleAuthMode();
            });
            
            // 菜单按钮
            elements.menuBtn.addEventListener('click', function() {
                elements.sidebar.classList.add('open');
            });
            
            // 关闭侧边栏
            elements.closeSidebar.addEventListener('click', function() {
                elements.sidebar.classList.remove('open');
            });
            
            // 菜单项点击
            elements.menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    showContent(target);
                    elements.sidebar.classList.remove('open');
                    
                    // 更新活动菜单项
                    elements.menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // 开始游戏按钮
            elements.startGameBtn.addEventListener('click', function() {
                showContent('game');
                startGame();
            });
            
            // 重新开始按钮
            elements.restartBtn.addEventListener('click', function() {
                startGame();
            });
            
            // 游戏返回主页按钮
            elements.gameHomeBtn.addEventListener('click', function() {
                showContent('home');
            });
            
            // 高分返回主页按钮
            elements.highScoreHomeBtn.addEventListener('click', function() {
                showContent('home');
            });
            
            // 高分重新开始按钮
            elements.highScoreRestartBtn.addEventListener('click', function() {
                startGame();
            });
            
            // 商店标签切换
            elements.shopTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 更新活动标签
                    elements.shopTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示对应内容
                    elements.skinsTab.classList.add('d-none');
                    elements.avatarsTab.classList.add('d-none');
                    elements.vipTab.classList.add('d-none');
                    document.getElementById(`${tabId}-tab`).classList.remove('d-none');
                });
            });
            
            // 个人资料表单提交
            elements.profileForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveProfile();
            });
            
            // 头像点击
            elements.profileAvatar.addEventListener('click', function() {
                changeAvatar();
            });
            
            // 寻找对手按钮
            elements.findOpponentBtn.addEventListener('click', function() {
                findOpponent();
            });
            
            // 管理员标签切换
            elements.adminTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 更新活动标签
                    elements.adminTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示对应内容
                    document.getElementById('users-tab').classList.add('d-none');
                    document.getElementById('reports-tab').classList.add('d-none');
                    document.getElementById(`${tabId}-tab`).classList.remove('d-none');
                });
            });
            
            // 收回账户按钮
            elements.revokeAccountBtn.addEventListener('click', function() {
                revokeAccount();
            });
            
            // 更新网站按钮
            elements.updateSiteBtn.addEventListener('click', function() {
                updateSite();
            });
            
            // 提交代码按钮
            elements.updateCodeBtn.addEventListener('click', function() {
                submitCodeUpdate();
            });
            
            // 键盘控制
            window.addEventListener('keydown', function(e) {
                if (gameData.gameState.isPlaying) {
                    gameData.gameState.keysPressed[e.key] = true;
                    
                    // 防止方向键滚动页面
                    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                        e.preventDefault();
                    }
                    
                    // 空格键使用钥匙
                    if (e.key === ' ' && gameData.gameState.keys > 0) {
                        showKeyModal();
                    }
                }
            });
            
            window.addEventListener('keyup', function(e) {
                if (gameData.gameState.isPlaying) {
                    gameData.gameState.keysPressed[e.key] = false;
                }
            });
            
            // 移动控制按钮
            elements.mobileUp.addEventListener('touchstart', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowUp'] = true;
            });
            
            elements.mobileUp.addEventListener('touchend', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowUp'] = false;
            });
            
            elements.mobileLeft.addEventListener('touchstart', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowLeft'] = true;
            });
            
            elements.mobileLeft.addEventListener('touchend', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowLeft'] = false;
            });
            
            elements.mobileRight.addEventListener('touchstart', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowRight'] = true;
            });
            
            elements.mobileRight.addEventListener('touchend', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowRight'] = false;
            });
            
            elements.mobileDown.addEventListener('touchstart', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowDown'] = true;
            });
            
            elements.mobileDown.addEventListener('touchend', function(e) {
                e.preventDefault();
                gameData.gameState.keysPressed['ArrowDown'] = false;
            });
            
            elements.mobileAction.addEventListener('click', function() {
                if (gameData.gameState.isPlaying && gameData.gameState.keys > 0) {
                    showKeyModal();
                }
            });
            
            // 钥匙模态框
            elements.closeKeyModal.addEventListener('click', function() {
                elements.keyModal.classList.remove('open');
            });
            
            elements.cancelKey.addEventListener('click', function() {
                elements.keyModal.classList.remove('open');
            });
            
            elements.confirmKey.addEventListener('click', function() {
                useKey();
                elements.keyModal.classList.remove('open');
            });
            
            // 消息模态框
            elements.closeMessageModal.addEventListener('click', function() {
                elements.messageModal.classList.remove('open');
            });
            
            elements.confirmMessage.addEventListener('click', function() {
                elements.messageModal.classList.remove('open');
            });
        }

        // 处理认证提交
        function handleAuthSubmit() {
            const username = elements.authUsername.value.trim();
            const password = elements.authPassword.value.trim();
            const isLogin = elements.authSubmit.textContent.includes('登录');
            
            if (isLogin) {
                // 登录逻辑
                const user = gameData.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    loginUser(user);
                    
                    // 记住用户
                    if (elements.rememberMe.checked) {
                        localStorage.setItem('rememberedUser', JSON.stringify({
                            username: user.username,
                            password: user.password
                        }));
                    } else {
                        localStorage.removeItem('rememberedUser');
                    }
                } else {
                    showMessage('错误', '用户名或密码不正确');
                }
            } else {
                // 注册逻辑
                if (username.length < 3) {
                    showMessage('错误', '用户名至少需要3个字符');
                    return;
                }
                
                if (password.length < 6) {
                    showMessage('错误', '密码至少需要6个字符');
                    return;
                }
                
                if (gameData.users.some(u => u.username === username)) {
                    showMessage('错误', '用户名已存在');
                    return;
                }
                
                const newUser = {
                    id: 'user' + (gameData.users.length + 1),
                    username: username,
                    password: password,
                    nickname: username,
                    highScore: 0,
                    coins: 50,
                    keys: 1,
                    avatar: '',
                    skins: ['default'],
                    equippedSkin: 'default',
                    avatars: ['default'],
                    equippedAvatar: 'default',
                    isAdmin: false,
                    isDev: false,
                    isVIP: false,
                    vipExpiry: null,
                    lastLogin: new Date().getTime()
                };
                
                gameData.users.push(newUser);
                loginUser(newUser);
                showMessage('成功', '注册成功！获得50金币和1把钥匙作为新手奖励');
            }
        }

        // 切换认证模式（登录/注册）
        function toggleAuthMode() {
            const isLogin = elements.authSubmit.textContent.includes('登录');
            
            if (isLogin) {
                elements.authTitle.textContent = '注册新账号';
                elements.authSubmit.textContent = '注册';
                elements.switchToRegister.textContent = '已有账号？立即登录';
            } else {
                elements.authTitle.textContent = '欢迎登录';
                elements.authSubmit.textContent = '登录';
                elements.switchToRegister.textContent = '还没有账号？立即注册';
            }
            
            // 清空表单
            elements.authUsername.value = '';
            elements.authPassword.value = '';
        }

        // 登录用户
        function loginUser(user) {
            gameData.currentUser = user;
            user.lastLogin = new Date().getTime();
            
            // 切换到主界面
            elements.authContainer.classList.add('d-none');
            elements.mainContainer.classList.remove('d-none');
            
            // 更新UI
            updateUI();
            
            // 显示主页
            showContent('home');
        }

        // 注销用户
        function logoutUser() {
            gameData.currentUser = null;
            
            // 切换到认证界面
            elements.mainContainer.classList.add('d-none');
            elements.authContainer.classList.remove('d-none');
            
            // 重置表单
            elements.authTitle.textContent = '欢迎登录';
            elements.authSubmit.textContent = '登录';
            elements.switchToRegister.textContent = '还没有账号？立即注册';
            elements.authUsername.value = '';
            elements.authPassword.value = '';
        }

        // 显示内容区域
        function showContent(target) {
            // 隐藏所有内容区域
            elements.homeContent.classList.add('d-none');
            elements.gameContainer.classList.add('d-none');
            elements.shopContent.classList.add('d-none');
            elements.profileContent.classList.add('d-none');
            elements.battleContent.classList.add('d-none');
            elements.adminContent.classList.add('d-none');
            elements.devContent.classList.add('d-none');
            
            // 显示目标内容区域
            switch (target) {
                case 'home':
                    elements.homeContent.classList.remove('d-none');
                    updateLeaderboard();
                    break;
                case 'game':
                    elements.gameContainer.classList.remove('d-none');
                    break;
                case 'shop':
                    elements.shopContent.classList.remove('d-none');
                    updateShop();
                    break;
                case 'profile':
                    elements.profileContent.classList.remove('d-none');
                    updateProfile();
                    break;
                case 'battle':
                    elements.battleContent.classList.remove('d-none');
                    updateBattleRooms();
                    break;
                case 'admin':
                    elements.adminContent.classList.remove('d-none');
                    updateAdminUsers();
                    break;
                case 'dev':
                    elements.devContent.classList.remove('d-none');
                    updateDevStats();
                    break;
            }
        }

        // 更新UI
        function updateUI() {
            if (!gameData.currentUser) return;
            
            const user = gameData.currentUser;
            
            // 更新头部信息
            elements.headerUsername.textContent = user.nickname || user.username;
            
            // 更新头像
            updateAvatarDisplay(elements.headerAvatar, user.equippedAvatar);
            
            // 更新主页统计
            elements.highScoreDisplay.textContent = user.highScore;
            elements.coinCount.textContent = user.coins;
            elements.keyCount.textContent = user.keys;
            
            // 显示/隐藏管理员菜单
            if (user.isAdmin) {
                elements.adminMenuItem.classList.remove('d-none');
            } else {
                elements.adminMenuItem.classList.add('d-none');
            }
            
            // 显示/隐藏开发者菜单
            if (user.isDev) {
                elements.devMenuItem.classList.remove('d-none');
            } else {
                elements.devMenuItem.classList.add('d-none');
            }
        }

        // 更新排行榜
        function updateLeaderboard() {
            elements.leaderboardList.innerHTML = '';
            
            gameData.leaderboard.sort((a, b) => b.score - a.score).forEach((user, index) => {
                const li = document.createElement('li');
                li.className = 'leaderboard-item';
                
                li.innerHTML = `
                    <div class="leaderboard-rank ${index < 3 ? 'top3' : ''}">${index + 1}</div>
                    <div class="leaderboard-avatar">${user.name.charAt(0).toUpperCase()}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${user.name}</div>
                        <div class="leaderboard-score">分数: <span>${user.score}</span></div>
                    </div>
                `;
                
                elements.leaderboardList.appendChild(li);
            });
        }

        // 更新商店
        function updateShop() {
            const user = gameData.currentUser;
            
            // 更新皮肤标签
            elements.skinsTab.innerHTML = '';
            gameData.shopItems.skins.forEach(skin => {
                const owned = user.skins.includes(skin.id);
                const equipped = user.equippedSkin === skin.id;
                
                const item = document.createElement('div');
                item.className = 'shop-item';
                
                item.innerHTML = `
                    <div class="item-image" style="background-color: ${skin.color};">
                        <i class="${skin.icon}" style="color: white;"></i>
                    </div>
                    <div class="item-name">${skin.name}</div>
                    <div class="item-price">${skin.price === 0 ? '免费' : `${skin.price}金币`}</div>
                    <button class="item-btn ${equipped ? 'equipped' : ''} ${owned && !equipped ? 'owned' : ''}" 
                            data-id="${skin.id}" data-type="skin" data-price="${skin.price}">
                        ${equipped ? '已装备' : owned ? '装备' : skin.price === 0 ? '使用' : '购买'}
                    </button>
                `;
                
                elements.skinsTab.appendChild(item);
            });
            
            // 更新头像标签
            elements.avatarsTab.innerHTML = '';
            gameData.shopItems.avatars.forEach(avatar => {
                const owned = user.avatars.includes(avatar.id);
                const equipped = user.equippedAvatar === avatar.id;
                
                const item = document.createElement('div');
                item.className = 'shop-item';
                
                item.innerHTML = `
                    <div class="item-image" style="background-color: ${avatar.color};">
                        <i class="${avatar.icon}" style="color: ${avatar.id === 'default' ? '#666' : 'white'};"></i>
                    </div>
                    <div class="item-name">${avatar.name}</div>
                    <div class="item-price">${avatar.price === 0 ? '免费' : `${avatar.price}金币`}</div>
                    <button class="item-btn ${equipped ? 'equipped' : ''} ${owned && !equipped ? 'owned' : ''}" 
                            data-id="${avatar.id}" data-type="avatar" data-price="${avatar.price}">
                        ${equipped ? '已装备' : owned ? '装备' : avatar.price === 0 ? '使用' : '购买'}
                    </button>
                `;
                
                elements.avatarsTab.appendChild(item);
            });
            
            // 更新VIP标签
            elements.vipTab.innerHTML = '';
            gameData.shopItems.vip.forEach(vip => {
                const item = document.createElement('div');
                item.className = 'shop-item';
                
                item.innerHTML = `
                    <div class="item-image" style="background: linear-gradient(135deg, ${vip.id === 'vip-year' ? '#4a6bff, #6c5ce7' : '#feca57, #ff9f43'});">
                        <i class="fas fa-crown" style="color: white;"></i>
                    </div>
                    <div class="item-name">${vip.name}</div>
                    <div class="item-price">${vip.price}金币</div>
                    <button class="item-btn" data-id="${vip.id}" data-type="vip" data-price="${vip.price}">
                        ${user.isVIP ? '续费' : '购买'}
                    </button>
                `;
                
                elements.vipTab.appendChild(item);
            });
            
            // 添加商店按钮事件
            document.querySelectorAll('.item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const type = this.getAttribute('data-type');
                    const price = parseInt(this.getAttribute('data-price'));
                    
                    handleShopItemClick(id, type, price, this);
                });
            });
        }

        // 处理商店物品点击
        function handleShopItemClick(id, type, price, button) {
            const user = gameData.currentUser;
            
            if (button.textContent === '购买' || button.textContent === '续费') {
                // 购买逻辑
                if (user.coins < price) {
                    showMessage('错误', '金币不足');
                    return;
                }
                
                user.coins -= price;
                
                if (type === 'skin') {
                    user.skins.push(id);
                    button.textContent = '装备';
                    button.classList.add('owned');
                } else if (type === 'avatar') {
                    user.avatars.push(id);
                    button.textContent = '装备';
                    button.classList.add('owned');
                } else if (type === 'vip') {
                    const duration = gameData.shopItems.vip.find(v => v.id === id).duration;
                    const now = new Date().getTime();
                    
                    if (user.isVIP && user.vipExpiry > now) {
                        user.vipExpiry += duration * 24 * 60 * 60 * 1000;
                    } else {
                        user.isVIP = true;
                        user.vipExpiry = now + duration * 24 * 60 * 60 * 1000;
                    }
                    
                    showMessage('成功', `成功购买${id === 'vip-year' ? 'VIP年卡' : 'VIP月卡'}`);
                }
                
                updateUI();
            } else if (button.textContent === '装备' || button.textContent === '使用') {
                // 装备逻辑
                if (type === 'skin') {
                    user.equippedSkin = id;
                    document.querySelectorAll('.item-btn[data-type="skin"]').forEach(btn => {
                        btn.classList.remove('equipped');
                        if (btn.getAttribute('data-id') === user.equippedSkin) {
                            btn.textContent = '已装备';
                            btn.classList.add('equipped');
                        } else if (user.skins.includes(btn.getAttribute('data-id'))) {
                            btn.textContent = '装备';
                        }
                    });
                    
                    // 更新玩家皮肤
                    if (elements.gameContainer.classList.contains('d-none')) {
                        updateAvatarDisplay(elements.player, id);
                    }
                } else if (type === 'avatar') {
                    user.equippedAvatar = id;
                    document.querySelectorAll('.item-btn[data-type="avatar"]').forEach(btn => {
                        btn.classList.remove('equipped');
                        if (btn.getAttribute('data-id') === user.equippedAvatar) {
                            btn.textContent = '已装备';
                            btn.classList.add('equipped');
                        } else if (user.avatars.includes(btn.getAttribute('data-id'))) {
                            btn.textContent = '装备';
                        }
                    });
                    
                    // 更新头像显示
                    updateAvatarDisplay(elements.headerAvatar, id);
                    updateAvatarDisplay(elements.profileAvatar, id);
                }
            }
        }

        // 更新个人资料
        function updateProfile() {
            const user = gameData.currentUser;
            
            // 更新头像
            updateAvatarDisplay(elements.profileAvatar, user.equippedAvatar);
            
            // 更新徽章
            elements.profileDisplayName.textContent = user.nickname || user.username;
            
            if (user.isVIP) {
                elements.vipBadge.classList.remove('d-none');
            } else {
                elements.vipBadge.classList.add('d-none');
            }
            
            if (user.isAdmin) {
                elements.adminBadge.classList.remove('d-none');
            } else {
                elements.adminBadge.classList.add('d-none');
            }
            
            // 更新表单
            elements.profileUsername.value = user.username;
            elements.profileNickname.value = user.nickname || user.username;
            elements.profilePassword.value = '';
            elements.profileConfirmPassword.value = '';
            
            // 更新统计
            elements.profileHighScore.textContent = user.highScore;
            elements.profileCoins.textContent = user.coins;
            elements.profileKeys.textContent = user.keys;
        }

        // 保存个人资料
        function saveProfile() {
            const user = gameData.currentUser;
            const nickname = elements.profileNickname.value.trim();
            const password = elements.profilePassword.value.trim();
            const confirmPassword = elements.profileConfirmPassword.value.trim();
            
            // 验证昵称
            if (nickname.length < 2) {
                showMessage('错误', '昵称至少需要2个字符');
                return;
            }
            
            // 验证密码
            if (password || confirmPassword) {
                if (password.length < 6) {
                    showMessage('错误', '密码至少需要6个字符');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showMessage('错误', '两次输入的密码不一致');
                    return;
                }
                
                user.password = password;
            }
            
            // 更新用户信息
            user.nickname = nickname;
            
            // 更新UI
            updateUI();
            updateProfile();
            
            showMessage('成功', '个人资料已保存');
        }

        // 更改头像
        function changeAvatar() {
            const user = gameData.currentUser;
            
            if (!user.avatars.includes('custom')) {
                showMessage('提示', '你需要先购买自定义头像功能');
                showContent('shop');
                return;
            }
            
            showMessage('提示', '自定义头像功能即将推出，请先使用预设头像');
        }

        // 更新对战房间
        function updateBattleRooms() {
            elements.battleRooms.innerHTML = '';
            
            gameData.onlineUsers.forEach(user => {
                if (user.id === gameData.currentUser.id) return;
                
                const room = document.createElement('div');
                room.className = 'battle-room';
                
                room.innerHTML = `
                    <div class="battle-room-avatar">${user.name.charAt(0).toUpperCase()}</div>
                    <div class="battle-room-info">
                        <div class="battle-room-name">${user.name}</div>
                        <div class="battle-room-status">最高分: ${user.score}</div>
                    </div>
                    <button class="battle-room-join">挑战</button>
                `;
                
                elements.battleRooms.appendChild(room);
            });
            
            // 添加挑战按钮事件
            document.querySelectorAll('.battle-room-join').forEach(btn => {
                btn.addEventListener('click', function() {
                    startBattle();
                });
            });
        }

        // 寻找对手
        function findOpponent() {
            showMessage('提示', '正在寻找对手...');
            
            // 模拟延迟
            setTimeout(() => {
                if (Math.random() > 0.3) {
                    startBattle();
                } else {
                    showMessage('提示', '没有找到合适的对手，请稍后再试');
                }
            }, 1500);
        }

        // 开始对战
        function startBattle() {
            showContent('game');
            startGame(true);
        }

        // 更新管理员用户列表
        function updateAdminUsers() {
            elements.adminUsersList.innerHTML = '';
            
            gameData.users.forEach(user => {
                if (user.id === gameData.currentUser.id) return;
                
                const userEl = document.createElement('div');
                userEl.className = 'admin-user';
                
                userEl.innerHTML = `
                    <div class="admin-user-avatar">${user.username.charAt(0).toUpperCase()}</div>
                    <div class="admin-user-info">
                        <div class="admin-user-name">${user.nickname || user.username} ${user.isVIP ? '(VIP)' : ''}</div>
                        <div class="admin-user-id">ID: ${user.id}</div>
                    </div>
                    <div class="admin-user-actions">
                        <button class="admin-user-btn promote">${user.isAdmin ? '取消管理' : '设为管理员'}</button>
                        <button class="admin-user-btn ban">${user.isAdmin ? '禁用' : '封禁'}</button>
                        <button class="admin-user-btn gift">赠送金币</button>
                    </div>
                `;
                
                elements.adminUsersList.appendChild(userEl);
            });
            
            // 添加管理员按钮事件
            document.querySelectorAll('.admin-user-btn.promote').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.closest('.admin-user').querySelector('.admin-user-id').textContent.split(': ')[1];
                    promoteUser(userId);
                });
            });
            
            document.querySelectorAll('.admin-user-btn.ban').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.closest('.admin-user').querySelector('.admin-user-id').textContent.split(': ')[1];
                    banUser(userId);
                });
            });
            
            document.querySelectorAll('.admin-user-btn.gift').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.closest('.admin-user').querySelector('.admin-user-id').textContent.split(': ')[1];
                    giftCoins(userId);
                });
            });
        }

        // 提升用户为管理员
        function promoteUser(userId) {
            const user = gameData.users.find(u => u.id === userId);
            
            if (user) {
                user.isAdmin = !user.isAdmin;
                updateAdminUsers();
                showMessage('成功', `已${user.isAdmin ? '设为管理员' : '取消管理员权限'}`);
            }
        }

        // 封禁用户
        function banUser(userId) {
            const user = gameData.users.find(u => u.id === userId);
            
            if (user) {
                if (user.isAdmin) {
                    showMessage('错误', '不能封禁其他管理员');
                    return;
                }
                
                if (confirm(`确定要封禁用户 ${user.nickname || user.username} 吗？`)) {
                    gameData.users = gameData.users.filter(u => u.id !== userId);
                    updateAdminUsers();
                    showMessage('成功', '用户已封禁');
                }
            }
        }

        // 赠送金币
        function giftCoins(userId) {
            const user = gameData.users.find(u => u.id === userId);
            
            if (user) {
                const amount = prompt(`请输入要赠送给 ${user.nickname || user.username} 的金币数量:`, '100');
                
                if (amount && !isNaN(amount)) {
                    user.coins += parseInt(amount);
                    updateAdminUsers();
                    showMessage('成功', `已赠送 ${amount} 金币`);
                }
            }
        }

        // 更新开发者统计
        function updateDevStats() {
            elements.totalUsers.textContent = gameData.users.length;
            elements.activeUsers.textContent = gameData.users.filter(u => new Date().getTime() - u.lastLogin < 24 * 60 * 60 * 1000).length;
            elements.totalGames.textContent = gameData.leaderboard.reduce((sum, user) => sum + user.score, 0);
            elements.globalHighScore.textContent = Math.max(...gameData.leaderboard.map(user => user.score));
        }

        // 收回账户
        function revokeAccount() {
            const username = prompt('请输入要收回的账户用户名:');
            
            if (username) {
                const user = gameData.users.find(u => u.username === username);
                
                if (user) {
                    if (confirm(`确定要收回账户 ${username} 吗？密码将重置为默认密码`)) {
                        user.password = '19996837879gxhbsh';
                        showMessage('成功', `账户 ${username} 已收回，密码已重置`);
                    }
                } else {
                    showMessage('错误', '未找到该用户');
                }
            }
        }

        // 更新网站
        function updateSite() {
            showMessage('提示', '网站更新功能将在实际部署时启用');
        }

        // 提交代码更新
        function submitCodeUpdate() {
            const code = elements.codeEditor.value.trim();
            
            if (code) {
                if (confirm('确定要提交代码更新吗？这将会修改网站内容')) {
                    showMessage('成功', '代码更新已提交（演示中不会实际更新）');
                    elements.codeEditor.value = '';
                }
            } else {
                showMessage('错误', '请输入更新代码');
            }
        }

        // 开始游戏
        function startGame(isBattle = false) {
            const user = gameData.currentUser;
            
            // 重置游戏状态
            gameData.gameState = {
                isPlaying: true,
                score: 0,
                lives: 3,
                keys: user.keys,
                speed: 2,
                level: 1,
                playerX: elements.gameContainer.offsetWidth / 2 - 20,
                playerY: elements.gameContainer.offsetHeight - 60,
                playerWidth: 40,
                playerHeight: 40,
                bombs: [],
                powerups: [],
                lastBombTime: 0,
                lastPowerupTime: 0,
                animationId: null,
                startTime: Date.now(),
                keysPressed: {},
                isBattle: isBattle
            };
            
            // 更新UI
            elements.gameScore.textContent = '0';
            elements.gameLives.textContent = gameData.gameState.lives;
            elements.gameKeys.textContent = gameData.gameState.keys;
            
            // 隐藏游戏结束和高分界面
            elements.gameOverScreen.classList.add('d-none');
            elements.highScoreScreen.classList.add('d-none');
            
            // 设置玩家初始位置和皮肤
            elements.player.style.left = `${gameData.gameState.playerX}px`;
            elements.player.style.top = `${gameData.gameState.playerY}px`;
            updateAvatarDisplay(elements.player, user.equippedSkin);
            
            // 清除所有炸弹和道具
            document.querySelectorAll('.bomb, .powerup').forEach(el => el.remove());
            
            // 开始游戏循环
            gameLoop();
        }

        // 游戏主循环
        function gameLoop() {
            if (!gameData.gameState.isPlaying) return;
            
            const now = Date.now();
            const gameTime = (now - gameData.gameState.startTime) / 1000;
            const containerWidth = elements.gameContainer.offsetWidth;
            const containerHeight = elements.gameContainer.offsetHeight;
            
            // 更新游戏速度
            gameData.gameState.level = Math.floor(gameTime / 10) + 1;
            gameData.gameState.speed = 2 + gameData.gameState.level * 0.5;
            
            // 处理玩家输入
            handlePlayerInput(containerWidth, containerHeight);
            
            // 生成炸弹
            if (now - gameData.gameState.lastBombTime > 1000 / gameData.gameState.level) {
                generateBomb(containerWidth);
                gameData.gameState.lastBombTime = now;
            }
            
            // 生成道具
            if (now - gameData.gameState.lastPowerupTime > 5000) {
                if (Math.random() < 0.3) {
                    generatePowerup(containerWidth);
                    gameData.gameState.lastPowerupTime = now;
                }
            }
            
            // 更新炸弹位置
            updateBombs(containerHeight);
            
            // 更新道具位置
            updatePowerups(containerHeight);
            
            // 检测碰撞
            checkCollisions();
            
            // 继续游戏循环
            gameData.gameState.animationId = requestAnimationFrame(gameLoop);
        }

        // 处理玩家输入
        function handlePlayerInput(containerWidth, containerHeight) {
            const moveSpeed = 5;
            let moved = false;
            
            // 键盘控制
            if (gameData.gameState.keysPressed['ArrowLeft'] || gameData.gameState.keysPressed['a']) {
                gameData.gameState.playerX = Math.max(0, gameData.gameState.playerX - moveSpeed);
                moved = true;
            }
            
            if (gameData.gameState.keysPressed['ArrowRight'] || gameData.gameState.keysPressed['d']) {
                gameData.gameState.playerX = Math.min(containerWidth - gameData.gameState.playerWidth, gameData.gameState.playerX + moveSpeed);
                moved = true;
            }
            
            if (gameData.gameState.keysPressed['ArrowUp'] || gameData.gameState.keysPressed['w']) {
                gameData.gameState.playerY = Math.max(0, gameData.gameState.playerY - moveSpeed);
                moved = true;
            }
            
            if (gameData.gameState.keysPressed['ArrowDown'] || gameData.gameState.keysPressed['s']) {
                gameData.gameState.playerY = Math.min(containerHeight - gameData.gameState.playerHeight, gameData.gameState.playerY + moveSpeed);
                moved = true;
            }
            
            // 更新玩家位置
            if (moved) {
                elements.player.style.left = `${gameData.gameState.playerX}px`;
                elements.player.style.top = `${gameData.gameState.playerY}px`;
            }
        }

        // 生成炸弹
        function generateBomb(containerWidth) {
            const bomb = {
                id: 'bomb-' + Date.now(),
                x: Math.random() * (containerWidth - 30),
                y: -30,
                width: 30,
                height: 30,
                speed: gameData.gameState.speed * (0.8 + Math.random() * 0.4)
            };
            
            gameData.gameState.bombs.push(bomb);
            
            // 创建炸弹元素
            const bombEl = document.createElement('div');
            bombEl.className = 'bomb';
            bombEl.id = bomb.id;
            bombEl.style.left = `${bomb.x}px`;
            bombEl.style.top = `${bomb.y}px`;
            bombEl.textContent = '💣';
            
            elements.gameContainer.appendChild(bombEl);
        }

        // 生成道具
        function generatePowerup(containerWidth) {
            const types = ['speed-up', 'speed-down', 'life', 'key', 'coin'];
            const weights = [0.25, 0.15, 0.2, 0.15, 0.25]; // 权重
            let random = Math.random();
            let typeIndex = 0;
            let sum = 0;
            
            for (let i = 0; i < weights.length; i++) {
                sum += weights[i];
                if (random <= sum) {
                    typeIndex = i;
                    break;
                }
            }
            
            const type = types[typeIndex];
            const powerup = {
                id: 'powerup-' + Date.now(),
                x: Math.random() * (containerWidth - 25),
                y: -25,
                width: 25,
                height: 25,
                speed: gameData.gameState.speed * 0.8,
                type: type
            };
            
            gameData.gameState.powerups.push(powerup);
            
            // 创建道具元素
            const powerupEl = document.createElement('div');
            powerupEl.className = `powerup ${type}`;
            powerupEl.id = powerup.id;
            powerupEl.style.left = `${powerup.x}px`;
            powerupEl.style.top = `${powerup.y}px`;
            
            // 设置道具图标
            switch (type) {
                case 'speed-up':
                    powerupEl.textContent = '⚡';
                    break;
                case 'speed-down':
                    powerupEl.textContent = '🐢';
                    break;
                case 'life':
                    powerupEl.textContent = '❤️';
                    break;
                case 'key':
                    powerupEl.textContent = '🔑';
                    break;
                case 'coin':
                    powerupEl.textContent = '🪙';
                    break;
            }
            
            elements.gameContainer.appendChild(powerupEl);
        }

        // 更新炸弹位置
        function updateBombs(containerHeight) {
            gameData.gameState.bombs.forEach(bomb => {
                bomb.y += bomb.speed;
                
                const bombEl = document.getElementById(bomb.id);
                if (bombEl) {
                    bombEl.style.top = `${bomb.y}px`;
                }
                
                // 移除超出屏幕的炸弹
                if (bomb.y > containerHeight) {
                    gameData.gameState.bombs = gameData.gameState.bombs.filter(b => b.id !== bomb.id);
                    if (bombEl) {
                        bombEl.remove();
                    }
                }
            });
        }

        // 更新道具位置
        function updatePowerups(containerHeight) {
            gameData.gameState.powerups.forEach(powerup => {
                powerup.y += powerup.speed;
                
                const powerupEl = document.getElementById(powerup.id);
                if (powerupEl) {
                    powerupEl.style.top = `${powerup.y}px`;
                }
                
                // 移除超出屏幕的道具
                if (powerup.y > containerHeight) {
                    gameData.gameState.powerups = gameData.gameState.powerups.filter(p => p.id !== powerup.id);
                    if (powerupEl) {
                        powerupEl.remove();
                    }
                }
            });
        }

        // 检测碰撞
        function checkCollisions() {
            const player = {
                x: gameData.gameState.playerX,
                y: gameData.gameState.playerY,
                width: gameData.gameState.playerWidth,
                height: gameData.gameState.playerHeight
            };
            
            // 检测炸弹碰撞
            gameData.gameState.bombs.forEach(bomb => {
                if (checkCollision(player, bomb)) {
                    handleBombCollision(bomb);
                }
            });
            
            // 检测道具碰撞
            gameData.gameState.powerups.forEach(powerup => {
                if (checkCollision(player, powerup)) {
                    handlePowerupCollision(powerup);
                }
            });
        }

        // 检测两个矩形是否碰撞
        function checkCollision(rect1, rect2) {
            return (
                rect1.x < rect2.x + rect2.width &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.height &&
                rect1.y + rect1.height > rect2.y
            );
        }

        // 处理炸弹碰撞
        function handleBombCollision(bomb) {
            // 移除炸弹
            gameData.gameState.bombs = gameData.gameState.bombs.filter(b => b.id !== bomb.id);
            const bombEl = document.getElementById(bomb.id);
            if (bombEl) {
                bombEl.remove();
            }
            
            // 减少生命值
            gameData.gameState.lives--;
            elements.gameLives.textContent = gameData.gameState.lives;
            
            // 播放碰撞效果
            elements.player.classList.add('shake');
            setTimeout(() => {
                elements.player.classList.remove('shake');
            }, 500);
            
            // 检查游戏是否结束
            if (gameData.gameState.lives <= 0) {
                endGame();
            }
        }

        // 处理道具碰撞
        function handlePowerupCollision(powerup) {
            // 移除道具
            gameData.gameState.powerups = gameData.gameState.powerups.filter(p => p.id !== powerup.id);
            const powerupEl = document.getElementById(powerup.id);
            if (powerupEl) {
                powerupEl.remove();
            }
            
            // 应用道具效果
            switch (powerup.type) {
                case 'speed-up':
                    gameData.gameState.score += 10;
                    elements.gameScore.textContent = gameData.gameState.score;
                    showMessage('获得加速', '+10分', 1000);
                    break;
                case 'speed-down':
                    gameData.gameState.score += 5;
                    elements.gameScore.textContent = gameData.gameState.score;
                    showMessage('减速', '+5分', 1000);
                    break;
                case 'life':
                    gameData.gameState.lives = Math.min(3, gameData.gameState.lives + 1);
                    elements.gameLives.textContent = gameData.gameState.lives;
                    showMessage('获得生命', '+1生命', 1000);
                    break;
                case 'key':
                    gameData.gameState.keys++;
                    elements.gameKeys.textContent = gameData.gameState.keys;
                    showMessage('获得钥匙', '+1钥匙', 1000);
                    break;
                case 'coin':
                    gameData.gameState.score += 5;
                    elements.gameScore.textContent = gameData.gameState.score;
                    showMessage('获得金币', '+5分', 1000);
                    break;
            }
        }

        // 使用钥匙
        function useKey() {
            if (gameData.gameState.keys > 0) {
                gameData.gameState.keys--;
                gameData.gameState.lives = Math.min(3, gameData.gameState.lives + 1);
                
                elements.gameKeys.textContent = gameData.gameState.keys;
                elements.gameLives.textContent = gameData.gameState.lives;
                
                showMessage('使用钥匙', '获得1条额外生命', 1000);
            }
        }

        // 显示钥匙确认模态框
        function showKeyModal() {
            elements.keyModal.classList.add('open');
        }

        // 结束游戏
        function endGame() {
            gameData.gameState.isPlaying = false;
            cancelAnimationFrame(gameData.gameState.animationId);
            
            const user = gameData.currentUser;
            const isNewHighScore = gameData.gameState.score > user.highScore;
            
            // 更新用户数据
            if (isNewHighScore) {
                user.highScore = gameData.gameState.score;
                
                // 更新排行榜
                const existingIndex = gameData.leaderboard.findIndex(u => u.id === user.id);
                if (existingIndex >= 0) {
                    gameData.leaderboard[existingIndex].score = user.highScore;
                } else {
                    gameData.leaderboard.push({
                        id: user.id,
                        name: user.nickname || user.username,
                        score: user.highScore,
                        avatar: user.equippedAvatar
                    });
                }
            }
            
            user.keys = gameData.gameState.keys;
            user.coins += Math.floor(gameData.gameState.score / 10);
            
            // 更新UI
            updateUI();
            
            // 显示游戏结束或高分界面
            elements.finalScore.textContent = gameData.gameState.score;
            
            if (isNewHighScore) {
                elements.newHighScore.textContent = gameData.gameState.score;
                elements.highScoreScreen.classList.remove('d-none');
            } else {
                elements.gameOverScreen.classList.remove('d-none');
            }
        }

        // 更新头像显示
        function updateAvatarDisplay(element, avatarId) {
            const avatar = gameData.shopItems.avatars.find(a => a.id === avatarId) || 
                          gameData.shopItems.skins.find(s => s.id === avatarId);
            
            if (avatar) {
                element.innerHTML = '';
                element.style.backgroundColor = avatar.color;
                
                const icon = document.createElement('i');
                icon.className = avatar.icon;
                icon.style.color = avatar.id === 'default' ? '#666' : 'white';
                icon.style.fontSize = '20px';
                
                element.appendChild(icon);
            }
        }

        // 显示消息
        function showMessage(title, text, duration = 3000) {
            elements.messageTitle.textContent = title;
            elements.messageText.textContent = text;
            elements.messageModal.classList.add('open');
            
            if (duration > 0) {
                setTimeout(() => {
                    elements.messageModal.classList.remove('open');
                }, duration);
            }
        }

        // 初始化游戏
        init();
    </script>
</body>
</html>